<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Audio de G√™nesis 1</title>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      padding: 2rem; 
      max-width: 800px; 
      margin: auto; 
      line-height: 1.6;
    }
    h1 {
      text-align: center; 
      color: #2c3e50; 
      margin-bottom: 1.5rem;
      font-size: 2.2rem;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }
    .verse { 
      background: #fff; 
      border-radius: 12px; 
      box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
      padding: 1.5rem; 
      margin-bottom: 1.8rem; 
      transition: transform 0.3s ease;
    }
    .verse:hover {
      transform: translateY(-3px);
    }
    .word { 
      transition: all 0.3s ease; 
      cursor: pointer; 
      padding: 2px 4px;
      border-radius: 3px;
    }
    .word:hover {
      background-color: #f0f7ff;
    }
    .highlight { 
      color: #e74c3c; 
      font-weight: bold; 
      background-color: #fff4f2;
      padding: 2px 4px;
      border-radius: 3px;
    }
    .controls button { 
      margin-right: 0.7rem; 
      margin-top: 0.7rem; 
      padding: 0.6rem 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s ease;
    }
    .global-controls { 
      text-align: center; 
      margin-bottom: 2rem; 
      background: linear-gradient(to right, #6a11cb 0%, #2575fc 100%);
      padding: 1.2rem; 
      border-radius: 12px; 
      box-shadow: 0 4px 15px rgba(0,0,0,0.15);
      position: sticky; 
      top: 15px; 
      z-index: 999; 
    }
    .global-controls button { 
      color: white; 
      margin: 0 0.7rem; 
      padding: 0.8rem 1.5rem; 
      border: none; 
      border-radius: 8px; 
      cursor: pointer; 
      font-size: 1rem;
      font-weight: 600;
      box-shadow: 0 3px 6px rgba(0,0,0,0.16);
      transition: all 0.3s ease;
    }
    #playAllEN { 
      background: linear-gradient(to right, #8e44ad 0%, #9b59b6 100%);
    }
    #playAllPT { 
      background: linear-gradient(to right, #27ae60 0%, #2ecc71 100%);
    }
    #stopAll { 
      background: linear-gradient(to right, #e74c3c 0%, #c0392b 100%);
    }
    .global-controls button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 12px rgba(0,0,0,0.2);
    }
    .repeat-active { 
      background-color: #ffb74d !important; 
      color: #000 !important; 
    }
    .ref-title { 
      font-size: 1.1rem; 
      color: #8e44ad; 
      margin-top: 0;
      margin-bottom: 1rem;
      font-weight: 600;
      border-bottom: 2px solid #f0f0f0;
      padding-bottom: 0.5rem;
    }
    .bold-paragraph { 
      font-weight: bold; 
      color: #2c3e50;
    }
    .language-toggle {
      background-color: #3498db !important;
      color: white !important;
    }
    .play-button {
      background-color: #2ecc71 !important;
      color: white !important;
    }
    .pause-button {
      background-color: #f39c12 !important;
      color: white !important;
    }
    .repeat-button {
      background-color: #9b59b6 !important;
      color: white !important;
    }
    footer {
      text-align: center;
      margin-top: 2rem;
      color: #7f8c8d;
      font-size: 0.9rem;
    }
    .playing-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background-color: #e74c3c;
      margin-right: 8px;
      animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
      0% { transform: scale(0.95); opacity: 0.7; }
      50% { transform: scale(1.1); opacity: 1; }
      100% { transform: scale(0.95); opacity: 0.7; }
    }
  </style>
</head>
<body>
  <h1>
    üìñ G√™nesis 1 ‚Äî Ingl√™s e Portugu√™s
  </h1>

  <div class="global-controls">
    <button id="playAllEN">‚ñ∂Ô∏è Ouvir Tudo (EN)</button>
    <button id="playAllPT">‚ñ∂Ô∏è Ouvir Tudo (PT)</button>
    <button id="stopAll">‚èπÔ∏è Parar Tudo</button>
  </div>

  <div id="container"></div>

  <footer>
    <p>Desenvolvido para estudo das Escrituras ‚Ä¢ Todos os direitos reservados</p>
  </footer>

  <script>
    const verses = [
      {
        "ref": "G√™nesis 1:1",
        "enText": "zzzzIn the beginning God created the heavens and the earth.",
        "ptText": "No princ√≠pio, Deus criou os c√©us e a terra.",
        "enFile": "kj-genesis-1-1-en-Aria.mp3",
        "ptFile": "kj-genesis-1-1-pt-Antonio.mp3"
      },
      {
        "ref": "G√™nesis 1:2",
        "enText": "Now the earth was formless and empty, darkness was over the surface of the deep, and the Spirit of God was hovering over the waters.",
        "ptText": "E a terra era sem forma e vazia; trevas cobriam a face do abismo, e o Esp√≠rito de Deus se movia sobre a face das √°guas.",
        "enFile": "kj-genesis-1-2-en-Aria.mp3",
        "ptFile": "kj-genesis-1-2-pt-Antonio.mp3"
      },
      {
        "ref": "G√™nesis 1:3",
        "enText": "And God said, Let there be light: and there was light.",
        "ptText": "Disse Deus: Haja luz; e houve luz.",
        "enFile": "kj-genesis-1-3-en-Aria.mp3",
        "ptFile": "kj-genesis-1-3-pt-Antonio.mp3"
      },
      {
        "ref": "G√™nesis 1:4",
        "enText": "God saw that the light was good, and he separated the light from the darkness.",
        "ptText": "E viu Deus que a luz era boa; e fez separa√ß√£o entre a luz e as trevas.",
        "enFile": "kj-genesis-1-4-en-Aria.mp3",
        "ptFile": "kj-genesis-1-4-pt-Antonio.mp3"
      },
      {
        "ref": "G√™nesis 1:5",
        "enText": "God called the light day, and the darkness he called night. And there was evening, and there was morning‚Äîthe first day.",
        "ptText": "E Deus chamou √† luz Dia; e √†s trevas chamou Noite. E foi a tarde e a manh√£, o dia primeiro.",
        "enFile": "kj-genesis-1-5-en-Aria.mp3",
        "ptFile": "kj-genesis-1-5-pt-Antonio.mp3"
      }
    ];

    const container = document.getElementById("container");
    let currentAudio = null;
    let rafId = null;
    let isGlobalPlayAll = false;
    let currentPlayAllLang = null;
    const repeatState = {};

    function renderTextWithSpans(text) {
      return text.split(" ").map(w => `<span class="word">${w}</span>`).join(" ");
    }

    // Fun√ß√£o para exibir mensagem de erro de √°udio
    function showAudioError() {
      Swal.fire({
        icon: 'error',
        title: 'Erro de √Åudio',
        text: 'N√£o foi poss√≠vel carregar o √°udio. Verifique se os arquivos est√£o na mesma pasta ou tente novamente mais tarde.',
        confirmButtonText: 'OK'
      });
    }

    verses.forEach((v, i) => {
      const div = document.createElement("div");
      div.className = "verse";
      div.innerHTML = `
        <h2 class="ref-title">${v.ref}</h2>
        <p id="en-${i}">${renderTextWithSpans(v.enText)}</p>
        <div class="controls">
          <button class="language-toggle" onclick="toggleTranslation(${i})">üåê Mostrar Tradu√ß√£o</button>
          <button class="repeat-button" id="repeat-toggle-${i}-en" onclick="toggleRepeat(${i}, 'en', this)">üîÅ Repetir</button>
          <button class="play-button" id="toggle-en-${i}" onclick="playIndividualVerse(${i}, 'en', this)">‚ñ∂Ô∏è Ingl√™s</button>
        </div>
        <div id="pt-wrapper-${i}" style="display:none;">
          <p id="pt-${i}">${renderTextWithSpans(v.ptText)}</p>
          <div class="controls">
            <button class="repeat-button" id="repeat-toggle-${i}-pt" onclick="toggleRepeat(${i}, 'pt', this)">üîÅ Repetir</button>
            <button class="play-button" id="toggle-pt-${i}" onclick="playIndividualVerse(${i}, 'pt', this)">‚ñ∂Ô∏è Portugu√™s</button>
          </div>
        </div>
        <audio id="audio-en-${i}" onerror="showAudioError()">
          <source src="${v.enFile}" type="audio/mpeg">
          Seu navegador n√£o suporta o elemento de √°udio.
        </audio>
        <audio id="audio-pt-${i}" onerror="showAudioError()">
          <source src="${v.ptFile}" type="audio/mpeg">
          Seu navegador n√£o suporta o elemento de √°udio.
        </audio>
      `;
      container.appendChild(div);
    });

    function toggleRepeat(index, lang, btn) {
      const key = `${lang}-${index}`;
      repeatState[key] = !repeatState[key];
      btn.classList.toggle('repeat-active', repeatState[key]);
      btn.textContent = repeatState[key] ? 'üîÅ Repetindo' : 'üîÅ Repetir';
    }

    // Fun√ß√£o para tocar vers√≠culos individuais
    function playIndividualVerse(index, lang, btn) {
      // Verifica se o Play All est√° ativo e mostra alerta se estiver
      if (isGlobalPlayAll) {
        Swal.fire({
          icon: 'info',
          title: 'Aten√ß√£o',
          text: 'Voc√™ est√° em Play All. Se quiser ouvir um vers√≠culo individual, primeiro clique em Stop.',
          confirmButtonText: 'OK'
        });
        return;
      }

      playVerse(index, lang, btn);
    }

    // Fun√ß√£o principal para tocar √°udio
    function playVerse(index, lang, btn) {
      const audio = document.getElementById(`audio-${lang}-${index}`);
      const paragraph = document.getElementById(`${lang}-${index}`);
      const words = paragraph.querySelectorAll(".word");

      // Se j√° est√° tocando, pausa
      if (!audio.paused) {
        audio.pause();
        updateButtonState(btn, lang, false);
        paragraph.classList.remove("bold-paragraph");
        cancelAnimationFrame(rafId);
        return;
      }

      // Para qualquer √°udio que esteja tocando atualmente
      if (currentAudio && currentAudio !== audio) {
        currentAudio.pause();
        const allButtons = document.querySelectorAll('.play-button');
        allButtons.forEach(b => {
          if (b.textContent.includes('‚è∏Ô∏è')) {
            const buttonLang = b.textContent.includes('Ingl√™s') ? 'en' : 'pt';
            updateButtonState(b, buttonLang, false);
          }
        });
      }

      // Configura os eventos de clique nas palavras
      words.forEach((word, wi) => {
        word.onclick = () => {
          if (audio.duration > 0 && !isNaN(audio.duration)) {
            audio.currentTime = (wi / words.length) * audio.duration;
            if (audio.paused) {
              audio.play().catch(e => console.error("Erro ao reproduzir √°udio:", e));
            }
          }
        };
      });

      // Tenta reproduzir o √°udio
      audio.play().then(() => {
        updateButtonState(btn, lang, true);
        paragraph.classList.add("bold-paragraph");
        syncWords(audio, words);

        // Configura o evento de t√©rmino
        audio.onended = () => {
          const key = `${lang}-${index}`;
          if (repeatState[key]) {
            audio.currentTime = 0;
            audio.play().catch(e => console.error("Erro ao reproduzir √°udio:", e));
            return;
          }
          cancelAnimationFrame(rafId);
          words.forEach(w => w.classList.remove("highlight"));
          paragraph.classList.remove("bold-paragraph");
          updateButtonState(btn, lang, false);
        };

        currentAudio = audio;
      }).catch(error => {
        console.error("Erro ao reproduzir √°udio:", error);
        showAudioError();
        updateButtonState(btn, lang, false);
      });
    }

    // Fun√ß√£o para atualizar o estado dos bot√µes
    function updateButtonState(btn, lang, isPlaying) {
      if (isPlaying) {
        btn.textContent = lang === 'en' ? "‚è∏Ô∏è Ingl√™s" : "‚è∏Ô∏è Portugu√™s";
        btn.classList.remove('play-button');
        btn.classList.add('pause-button');
      } else {
        btn.textContent = lang === 'en' ? "‚ñ∂Ô∏è Ingl√™s" : "‚ñ∂Ô∏è Portugu√™s";
        btn.classList.remove('pause-button');
        btn.classList.add('play-button');
      }
    }

    function stopAllAudio() {
      // Para todos os √°udios
      verses.forEach((_, i) => {
        // Ingl√™s
        const enAudio = document.getElementById(`audio-en-${i}`);
        enAudio.pause();
        enAudio.currentTime = 0;
        updateButtonState(document.getElementById(`toggle-en-${i}`), 'en', false);
        document.getElementById(`en-${i}`).classList.remove("bold-paragraph");

        // Portugu√™s
        const ptAudio = document.getElementById(`audio-pt-${i}`);
        ptAudio.pause();
        ptAudio.currentTime = 0;
        updateButtonState(document.getElementById(`toggle-pt-${i}`), 'pt', false);
        document.getElementById(`pt-${i}`).classList.remove("bold-paragraph");
      });

      // Limpa a anima√ß√£o
      cancelAnimationFrame(rafId);
      
      // Reseta as flags
      isGlobalPlayAll = false;
      currentPlayAllLang = null;
      
      // Reabilita os bot√µes
      document.getElementById("playAllEN").disabled = false;
      document.getElementById("playAllPT").disabled = false;
      document.getElementById("playAllEN").textContent = "‚ñ∂Ô∏è Ouvir Tudo (EN)";
      document.getElementById("playAllPT").textContent = "‚ñ∂Ô∏è Ouvir Tudo (PT)";
    }

    function toggleTranslation(index) {
      const wrapper = document.getElementById(`pt-wrapper-${index}`);
      const btn = document.querySelector(`button[onclick="toggleTranslation(${index})"]`);
      
      if (wrapper.style.display === "none") {
        wrapper.style.display = "block";
        btn.textContent = "üåê Ocultar Tradu√ß√£o";
      } else {
        wrapper.style.display = "none";
        btn.textContent = "üåê Mostrar Tradu√ß√£o";
      }
    }

    function syncWords(audio, words) {
      function step() {
        if (!audio.paused && audio.duration > 0 && !isNaN(audio.duration)) {
          const progress = audio.currentTime / audio.duration;
          const wordIndex = Math.floor(progress * words.length);
          words.forEach((w, i) => w.classList.toggle("highlight", i === wordIndex));
        }
        rafId = requestAnimationFrame(step);
      }
      step();
    }

    // Fun√ß√£o para tocar todos os vers√≠culos em uma l√≠ngua
    async function playAll(lang) {
      if (isGlobalPlayAll && currentPlayAllLang === lang) {
        // Se j√° est√° tocando, para a reprodu√ß√£o
        stopAllAudio();
        return;
      }
      
      stopAllAudio();
      isGlobalPlayAll = true;
      currentPlayAllLang = lang;
      
      // Atualiza o texto do bot√£o
      document.getElementById(`playAll${lang.toUpperCase()}`).textContent = "‚è∏Ô∏è Pausar Tudo";
      
      // Desabilita o bot√£o correspondente
      document.getElementById(`playAll${lang === 'en' ? 'PT' : 'EN'}`).disabled = true;
      
      // Para PT, mostra todas as tradu√ß√µes
      if (lang === 'pt') {
        verses.forEach((_, i) => {
          document.getElementById(`pt-wrapper-${i}`).style.display = "block";
          const toggleBtn = document.querySelector(`button[onclick="toggleTranslation(${i})"]`);
          if (toggleBtn) toggleBtn.textContent = "üåê Ocultar Tradu√ß√£o";
        });
      }

      // Reproduz cada vers√≠culo sequencialmente
      for (let i = 0; i < verses.length; i++) {
        // Se o Play All foi interrompido, para o loop
        if (!isGlobalPlayAll) break;
        
        const btn = document.getElementById(`toggle-${lang}-${i}`);
        const audio = document.getElementById(`audio-${lang}-${i}`);
        const paragraph = document.getElementById(`${lang}-${i}`);
        const words = paragraph.querySelectorAll(".word");
        
        // Prepara o √°udio
        audio.currentTime = 0;
        paragraph.classList.add("bold-paragraph");
        updateButtonState(btn, lang, true);
        
        // Configura os eventos de clique nas palavras
        words.forEach((word, wi) => {
          word.onclick = () => {
            if (audio.duration > 0 && !isNaN(audio.duration)) {
              audio.currentTime = (wi / words.length) * audio.duration;
              if (audio.paused) {
                audio.play().catch(e => console.error("Erro ao reproduzir √°udio:", e));
              }
            }
          };
        });
        
        // Sincroniza as palavras
        syncWords(audio, words);
        
        // Reproduz o √°udio e espera terminar
        try {
          await audio.play();
          
          // Aguarda o t√©rmino do √°udio
          await new Promise(resolve => {
            const checkEnded = () => {
              if (audio.ended) {
                resolve();
                return;
              }
              
              // Verifica se h√° repeti√ß√£o configurada
              const key = `${lang}-${i}`;
              if (repeatState[key] && isGlobalPlayAll) {
                audio.currentTime = 0;
                audio.play().catch(e => {
                  console.error("Erro ao reproduzir √°udio:", e);
                  resolve();
                });
                return;
              }
              
              setTimeout(checkEnded, 100);
            };
            
            checkEnded();
          });
        } catch (error) {
          console.error("Erro ao reproduzir √°udio:", error);
          showAudioError();
          break;
        }
        
        // Limpa o destaque
        words.forEach(w => w.classList.remove("highlight"));
        paragraph.classList.remove("bold-paragraph");
        updateButtonState(btn, lang, false);
      }
      
      // Para PT, esconde todas as tradu√ß√µes
      if (lang === 'pt') {
        verses.forEach((_, i) => {
          document.getElementById(`pt-wrapper-${i}`).style.display = "none";
          const toggleBtn = document.querySelector(`button[onclick="toggleTranslation(${i})"]`);
          if (toggleBtn) toggleBtn.textContent = "üåê Mostrar Tradu√ß√£o";
        });
      }
      
      // Reseta as flags e reabilita os bot√µes
      isGlobalPlayAll = false;
      document.getElementById("playAllEN").disabled = false;
      document.getElementById("playAllPT").disabled = false;
      document.getElementById("playAllEN").textContent = "‚ñ∂Ô∏è Ouvir Tudo (EN)";
      document.getElementById("playAllPT").textContent = "‚ñ∂Ô∏è Ouvir Tudo (PT)";
    }

    // Configura os eventos dos bot√µes de Play All
    document.getElementById("playAllEN").addEventListener("click", () => playAll('en'));
    document.getElementById("playAllPT").addEventListener("click", () => playAll('pt'));
    document.getElementById("stopAll").addEventListener("click", stopAllAudio);
  </script>
</body>
</html>
